---
title: "SWRã¨React hooksã§æ¡ä»¶ã‚’æº€ãŸã™ã¾ã§å®šæœŸçš„ã«ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã™ã‚‹å‡¦ç†ã‚’å®Ÿç¾"
emoji: "ğŸ“˜"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [swr,react,reacthooks,nextjs]
published: true
---
ã‚ã‚‹ç‰¹å®šã®æ¡ä»¶ã‚’æº€ãŸã™ã¾ã§ã€å®šæœŸçš„ã«ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã—ãŸã‹ã£ãŸã€‚
SWRã¨React hooksã‚’ä½¿ã£ã¦ã€ã‚ã‚‹ç¨‹åº¦ç°¡å˜ã«å‡¦ç†ãŒæ›¸ã‘ãŸã®ã§ç´¹ä»‹ã—ã¾ã™ã€‚

ä¾‹ãˆã°ã€ã™ã”ãæ™‚é–“ãŒã‹ã‹ã‚‹å‡¦ç†ï¼ˆå‹•ç”»ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¨ã‹ï¼‰ã‚’ä»Šã©ã®ãã‚‰ã„ã¾ã§å‡¦ç†ãŒé€²ã‚“ã§ã‚‹ã®ã‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç”»é¢ã¨ã—ã¦è¡¨ç¤ºã—ãŸã„å ´åˆãªã©ã«ä½¿ãˆã‚‹ã¨æ€ã„ã¾ã™ã€‚
# å®Œæˆå½¢
ã“ã‚Œã§æ¡ä»¶ã‚’æº€ãŸã™ã¾ã§ã€å®šæœŸçš„ãªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚
```tsx
import useSWR from 'swr'
import { useEffect, useState } from 'react';

function Status() {
  const [refreshInterval, setRefreshInterval] = useState(10000);
  const { data } = useSWR('/api/status', fetcher, { refreshInterval: refreshInterval })

  useEffect(() => {
    if (æ¡ä»¶ãŒæº€ãŸã•ã‚ŒãŸã‚‰) {
      setRefreshInterval(0);
    }
  }, [æ¡ä»¶]);

  if (!data) return <div>loading...</div>
  return <div>hello {data.status}!</div>
}
```

# ã‚„ã£ã¦ã„ã‚‹ã“ã¨
## SWRã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ŒrefreshIntervalã€ã§å®šæœŸçš„ãªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã‚’å®Ÿç¾
`refreshInterval`ã®å€¤ã‚’è¨­å®šã™ã‚‹ã ã‘ã§ã€å®šæœŸçš„ãªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
```tsx
const { data } = useSWR('/api/status', fetcher, { refreshInterval: refreshInterval })
```

https://swr.vercel.app/ja/docs/revalidation#%E5%AE%9A%E6%9C%9F%E7%9A%84%E3%81%AA%E5%86%8D%E6%A4%9C%E8%A8%BC

## ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã®é–“éš”ã‚’Stateã§ç®¡ç†
`refreshInterval`ã®å€¤ã‚’stateã§ç®¡ç†ã™ã‚‹ã“ã¨ã§ã€é€”ä¸­ã§ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã®é–“éš”ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚
```tsx
// 10000ã®å€¤ã¯å¥½ãã«å¤‰æ›´ã—ã¦ãã ã•ã„
const [refreshInterval, setRefreshInterval] = useState(10000);
```
https://ja.reactjs.org/docs/hooks-reference.html#usestate

## useEffectã§æ¡ä»¶ã‚’æº€ãŸã—ãŸã‚‰ã€`refreshInterval`ã®å€¤ã‚’0ã«æ›´æ–°ã—ã¦å®šæœŸçš„ãªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã‚’ã‚„ã‚ã‚‹
æ¡ä»¶ãŒæº€ãŸã•ã‚ŒãŸã‚‰ã€`refreshInterval`ã®å€¤ã‚’0ã«æ›´æ–°ã—ã¦å®šæœŸçš„ãªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã‚’çµ‚äº†ã•ã›ã¾ã™
```tsx
  useEffect(() => {
    if (æ¡ä»¶ãŒæº€ãŸã•ã‚ŒãŸã‚‰) {
      setRefreshInterval(0);
    }
  }, [æ¡ä»¶]);
```
https://ja.reactjs.org/docs/hooks-reference.html#useeffect
