---
title: "sentry-ravenã‹ã‚‰sentry-rubyç§»è¡Œæ™‚ã«æ°—ã‚’ã¤ã‘ã‚‹ã“ã¨"
emoji: "ğŸ”–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [sentry]
published: true
---

ä»Šã¾ã§ Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã® Sentry ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã—ã¦`sentry-raven`ã¨ã„ã† Gem ã‚’ä½¿ã‚ã›ã¦ã‚‚ã‚‰ã£ã¦ã¾ã—ãŸã€‚
https://github.com/getsentry/sentry-ruby/tree/master/sentry-raven

ãã®`sentry-raven`ãŒãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã«ãªã£ãŸãŸã‚ã€æœ€è¿‘`sentry-ruby`ã«ç§»è¡Œã—ã¾ã—ãŸã€‚
https://github.com/getsentry/sentry-ruby

ç§»è¡Œè‡ªä½“ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®é€šã‚Šã«é€²ã‚ã‚Œã°ãã“ã¾ã§å¤§å¤‰ã§ã¯ãªã„ã®ã§ã™ãŒã€1 ç‚¹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯æ›¸ã„ã¦ãªã„ç‚¹ã§æ°—ã‚’ã¤ã‘ãŸã»ã†ãŒã„ã„ã“ã¨ãŒã‚ã£ãŸã®ã§å…±æœ‰ã§ãã‚Œã°ã¨æ€ã„ã¾ã™ï¼ˆæ­£ç¢ºã«ã¯å…ƒã€…ã®ä½¿ã„æ–¹ãŒæ‚ªã‹ã£ãŸã ã‘ãªã®ã§ã™ãŒ...ï¼‰ã€‚
https://docs.sentry.io/platforms/ruby/migration/

## capture_exception ã¨ capture_message ã®å¼•æ•°ã‚’è¦‹ç›´ãã†

ä¾‹ãˆã°ç§»è¡Œå‰ã«ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒã‚ã£ãŸã¨ã—ã¾ã™ã€‚

```rb
begin
  1 / 0
rescue ZeroDivisionError => e
  Raven.capture_message(e)
end
```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã‚¨ãƒ©ãƒ¼ã¯å‡ºãªã„ã®ã§ã™ãŒã€ç§»è¡Œã—ã¦`Raven.capture_message(e)` ã‹ã‚‰ `Sentry.capture_message(e)`ã«å¤‰æ›´ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã—ã¾ã„ã¾ã™ã€‚

```
ArgumentError: expect the argument to be a String, got ZeroDivisionError (#<ZeroDivisionError: divided by 0>)
```

## sentry-raven ã§ã¯ capture_exception ã¨ capture_message ãŒã‚¨ã‚¤ãƒªã‚¢ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã ã£ãŸ

ãã‚‚ãã‚‚`capture_message`ã¯ Sentry ã«ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã‚’é€ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ãªã®ã§å¼•æ•°ã«æ–‡å­—åˆ—ã‚’æŒ‡å®šã—ãªã„ã¨ã„ã‘ã¾ã›ã‚“ã€‚
https://docs.sentry.io/platforms/ruby/usage/#capturing-messages

ã§ã¯ãªãœ`Raven.capture_message(e)`ã¯å¼•æ•°ã«æ–‡å­—åˆ—ã‚’æŒ‡å®šã—ãªãã¦ã‚‚å®Ÿè¡Œã§ãã¦ã„ãŸã®ã ã‚ã†ã¨èª¿ã¹ã¦ã‚‹ã¨ã€
ã©ã†ã‚„ã‚‰`capture_exception`ã¨`capture_message`ã¯ä¸¡æ–¹`capture_type`ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã ã£ãŸãŸã‚å®Ÿè¡Œã§ããŸã‚ˆã†ã§ã™ã€‚
https://www.rubydoc.info/gems/sentry-raven/Raven%2FRack.capture_type
https://github.com/getsentry/sentry-ruby/blob/master/sentry-raven/lib/raven/integrations/rack.rb#L35

`capture_message`ã®å¼•æ•°ãŒæ–‡å­—åˆ—ã§ã¯ãªãã¦ã‚‚`capture_exception`ã®æ–¹ã®å¼•æ•°ã¨ã—ã¦è§£é‡ˆã•ã‚Œã€`capture_exception`ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦å‹•ã„ã¦ã„ãŸã¿ãŸã„ã§ã™ã­ã€‚

ã§ã¯`sentry-ruby`ã§ã¯ã©ã†ã‹ã¨ã„ã†ã¨ã€è¦‹ãŸæ„Ÿã˜ãã‚Œãã‚Œåˆ¥å€‹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦ç‹¬ç«‹ã—ã¦ã„ã¾ã—ãŸã€‚
ãªã®ã§ç§»è¡Œã—ãŸæ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸã¨æ€ã‚ã‚Œã¾ã™ã€‚
https://github.com/getsentry/sentry-ruby/blob/master/sentry-ruby/lib/sentry-ruby.rb#L292
https://github.com/getsentry/sentry-ruby/blob/master/sentry-ruby/lib/sentry-ruby.rb#L284

ã‚‚ã—ã“ã‚Œã‹ã‚‰`sentry-raven`ã‹ã‚‰`sentry-ruby`ã«ç§»è¡Œã™ã‚‹æ–¹ãŒã„ã¾ã—ãŸã‚‰ã€ãŠæ°—ã‚’ã¤ã‘ãã ã•ã„ãƒ¼ï¼
